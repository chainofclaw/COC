# COC Single-Node Full Stack
# Usage: docker compose -f docker/docker-compose.yml up -d
version: "3.9"

services:
  node:
    build:
      context: ..
      dockerfile: docker/Dockerfile.node
    container_name: coc-node
    ports:
      - "18780:18780"   # RPC
      - "18781:18781"   # WebSocket
      - "19780:19780"   # P2P
      - "19781:19781"   # Wire
      - "5001:5001"     # IPFS
      - "9100:9100"     # Metrics
    volumes:
      - coc-data:/data/coc
    environment:
      - COC_DATA_DIR=/data/coc
    networks:
      - coc-internal
    restart: unless-stopped

  explorer:
    build:
      context: ..
      dockerfile: docker/Dockerfile.explorer
      args:
        NEXT_PUBLIC_RPC_URL: http://node:18780
        NEXT_PUBLIC_WS_URL: ws://node:18781
    container_name: coc-explorer
    ports:
      - "3000:3000"
    depends_on:
      node:
        condition: service_healthy
    networks:
      - coc-internal
    restart: unless-stopped

  website:
    build:
      context: ..
      dockerfile: docker/Dockerfile.website
    container_name: coc-website
    ports:
      - "3001:3001"
    networks:
      - coc-internal
    restart: unless-stopped

volumes:
  coc-data:

networks:
  coc-internal:
    driver: bridge
